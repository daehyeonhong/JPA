package com.springbook.biz.user;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;

public class UserServiceClient {

	public static void main(String[] args) {
		/* Create JPAEntityManager */
		EntityManagerFactory entityManagerFactory = Persistence.createEntityManagerFactory("JPAUserProject");
		EntityManager entityManager = entityManagerFactory.createEntityManager();

		EntityTransaction entityTransaction = entityManager.getTransaction();

		try {
			/* Transaction 시작 */
			entityTransaction.begin();

			/*
			 * 회원 등록 User user = new User(); user.setId("lim");
			 * user.setName("임꺽정"); user.setPassword("1234");
			 * user.setRole("user"); entityManager.persist(user);
			 */
			/* 회원 조회 */
			User searchUser = new User();
			searchUser = entityManager.find(User.class, "lim");

			System.out.printf("회원 정보: %s\n", searchUser);

			/* 회원 리스트 출력 */
			String jpql = "SELECT u FROM User u ORDER BY u.id";
			List<User> userList = entityManager.createQuery(jpql, User.class).getResultList();
			for (User u : userList) {
				System.out.printf("User==> %s\n", u);
			}

			entityTransaction.commit();
		} catch (Exception e) {
			e.getStackTrace();
			entityTransaction.rollback();/* 이전 상태로 되돌리기 */
		} finally {
			entityManager.close();/* EntityManager 해제 */
		}
		entityManagerFactory.close();/* EntityManagerFactory 해제 */
	}

}